#!/usr/bin/env python3

from subprocess import call
import time
import os
import sys

def sh(cmd):
    return call(cmd, shell=True)

with open(os.path.expanduser('~/.screenshot-area')) as f:
    lines = f.read().splitlines()
    SSHHOST = lines[0]
    SSHPORT = lines[1]
    SSHUSER = lines[2]
    SSHPASS = lines[3]
    SSHPATH = lines[4]
    BROWSERBASE = lines[5]

path = '~/Pictures/screenshots/'
grabtime = time.strftime('%Y-%m-%d_%H-%M-%S')
fn = grabtime + '.png'
fullpath = path + fn
thumb = path + grabtime + '-thumb.png'
url = BROWSERBASE + fn

time.sleep(0.2)
status = sh('scrot -s -t 20 {}'.format(fullpath))
if status != 0:
    sys.exit(status)
sh('sshpass -p \'{SSHPASS}\' scp -P {SSHPORT} {fullpath} {SSHUSER}@{SSHHOST}:{SSHPATH}'.format(
    **locals()))
sh('notify-send -i {} screenshot'.format(thumb))
sh('echo {} | xsel -i -p'.format(url))
sh('echo {} | xsel -i -b'.format(url))
time.sleep(5)
os.remove(os.path.expanduser(thumb))
